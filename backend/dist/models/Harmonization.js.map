{"version":3,"file":"Harmonization.js","sourceRoot":"","sources":["../../src/models/Harmonization.ts"],"names":[],"mappings":"AACA,OAAO,QAAQ,EAAE,EAAE,MAAM,EAAmB,MAAM,UAAU,CAAC;AAuB7D,MAAM,mBAAmB,GAA2B,IAAI,MAAM,CAC5D;IACE,GAAG,EAAE;QACH,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,CAAC,IAAI,EAAE,4BAA4B,CAAC;QAC9C,IAAI,EAAE,IAAI;QACV,SAAS,EAAE,CAAC,EAAE,EAAE,+BAA+B,CAAC;QAChD,SAAS,EAAE,CAAC,EAAE,EAAE,+BAA+B,CAAC;QAChD,KAAK,EAAE,IAAI;KACZ;IAED,aAAa,EAAE;QACb,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,CAAC,IAAI,EAAE,iCAAiC,CAAC;QACnD,IAAI,EAAE,IAAI;QACV,KAAK,EAAE,IAAI;KACZ;IAED,MAAM,EAAE;QACN,IAAI,EAAE,MAAM;QACZ,IAAI,EAAE,CAAC,SAAS,EAAE,UAAU,EAAE,QAAQ,CAAC;QACvC,OAAO,EAAE,SAAS;QAClB,QAAQ,EAAE,IAAI;QACd,KAAK,EAAE,IAAI;KACZ;IAED,kBAAkB,EAAE;QAClB,IAAI,EAAE,MAAM;QACZ,IAAI,EAAE,CAAC,KAAK,EAAE,MAAM,CAAC;QACrB,OAAO,EAAE,IAAI;KACd;IAED,UAAU,EAAE;QACV,IAAI,EAAE,IAAI;QACV,OAAO,EAAE,IAAI;KACd;IAED,cAAc,EAAE;QACd,IAAI,EAAE,CAAC,MAAM,CAAC;QACd,OAAO,EAAE,EAAE;KACZ;CACF,EACD;IACE,UAAU,EAAE,IAAI;IAChB,MAAM,EAAE;QACN,SAAS,EAAE,CAAC,IAAI,EAAE,GAAG,EAAE,EAAE;YACvB,OAAO,GAAG,CAAC,GAAG,CAAC;YACf,OAAO,GAAG,CAAC;QACb,CAAC;KACF;CACF,CACF,CAAC;AAMF,mBAAmB,CAAC,KAAK,CAAC,EAAE,GAAG,EAAE,CAAC,EAAE,aAAa,EAAE,CAAC,EAAE,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;AAE1E,mBAAmB,CAAC,KAAK,CAAC,EAAE,MAAM,EAAE,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;AAOxD,mBAAmB,CAAC,OAAO,CAAC,oBAAoB,CAAC,CAAC,GAAG,CAAC;IACpD,IAAI,CAAC,IAAI,CAAC,UAAU;QAAE,OAAO,KAAK,CAAC;IACnC,OAAO,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC;AACtE,CAAC,CAAC,CAAC;AAGH,mBAAmB,CAAC,OAAO,CAAC,eAAe,GAAG,KAAK,WAAW,GAAW;IACvE,OAAO,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC,IAAI,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC;AAC9D,CAAC,CAAC;AAMF,MAAM,aAAa,GAA0B,QAAQ,CAAC,KAAK,CACzD,eAAe,EACf,mBAAmB,CACpB,CAAC;AAEF,eAAe,aAAa,CAAC","sourcesContent":["// src/models/Harmonization.ts\r\nimport mongoose, { Schema, Document, Model } from 'mongoose';\r\n\r\n// ────────────────────────────────────────────────\r\n// Interface for TypeScript type safety\r\n// ────────────────────────────────────────────────\r\n\r\nexport interface IHarmonization extends Document {\r\n  fan: string;                    // 16-digit Fayda ID (National ID number)\r\n  accountNumber: string;          // Omo Bank account number\r\n  status: 'PENDING' | 'VERIFIED' | 'FAILED';\r\n  verificationMethod?: 'OTP' | 'FACE';\r\n  verifiedAt?: Date;\r\n  linkedAccounts?: string[];      // Array of linked bank accounts (if multiple)\r\n  createdAt: Date;                // Auto-added by timestamps\r\n  updatedAt: Date;                // Auto-added by timestamps\r\n\r\n  // Optional: virtual or helper methods can be added here\r\n}\r\n\r\n// ────────────────────────────────────────────────\r\n// Mongoose Schema\r\n// ────────────────────────────────────────────────\r\n\r\nconst HarmonizationSchema: Schema<IHarmonization> = new Schema(\r\n  {\r\n    fan: {\r\n      type: String,\r\n      required: [true, 'Fayda ID (FAN) is required'],\r\n      trim: true,\r\n      minlength: [16, 'FAN must be exactly 16 digits'],\r\n      maxlength: [16, 'FAN must be exactly 16 digits'],\r\n      index: true, // fast lookup by FAN\r\n    },\r\n\r\n    accountNumber: {\r\n      type: String,\r\n      required: [true, 'Bank account number is required'],\r\n      trim: true,\r\n      index: true, // fast lookup by account\r\n    },\r\n\r\n    status: {\r\n      type: String,\r\n      enum: ['PENDING', 'VERIFIED', 'FAILED'],\r\n      default: 'PENDING',\r\n      required: true,\r\n      index: true, // useful for filtering by status\r\n    },\r\n\r\n    verificationMethod: {\r\n      type: String,\r\n      enum: ['OTP', 'FACE'],\r\n      default: null,\r\n    },\r\n\r\n    verifiedAt: {\r\n      type: Date,\r\n      default: null,\r\n    },\r\n\r\n    linkedAccounts: {\r\n      type: [String],\r\n      default: [],\r\n    },\r\n  },\r\n  {\r\n    timestamps: true, // automatically adds createdAt & updatedAt\r\n    toJSON: {\r\n      transform: (_doc, ret) => {\r\n        delete ret.__v; // remove mongoose version key\r\n        return ret;\r\n      },\r\n    },\r\n  },\r\n);\r\n\r\n// ────────────────────────────────────────────────\r\n// Indexes (compound index for common queries)\r\n// ────────────────────────────────────────────────\r\n\r\nHarmonizationSchema.index({ fan: 1, accountNumber: 1 }, { unique: true });\r\n// Optional: index for status queries\r\nHarmonizationSchema.index({ status: 1, createdAt: -1 });\r\n\r\n// ────────────────────────────────────────────────\r\n// Optional: Virtuals / Methods / Statics\r\n// ────────────────────────────────────────────────\r\n\r\n// Example virtual: is recently verified\r\nHarmonizationSchema.virtual('isRecentlyVerified').get(function (this: IHarmonization) {\r\n  if (!this.verifiedAt) return false;\r\n  return Date.now() - this.verifiedAt.getTime() < 24 * 60 * 60 * 1000; // last 24h\r\n});\r\n\r\n// Example static: find latest attempt by FAN\r\nHarmonizationSchema.statics.findLatestByFan = async function (fan: string) {\r\n  return this.findOne({ fan }).sort({ createdAt: -1 }).lean();\r\n};\r\n\r\n// ────────────────────────────────────────────────\r\n// Export Model\r\n// ────────────────────────────────────────────────\r\n\r\nconst Harmonization: Model<IHarmonization> = mongoose.model<IHarmonization>(\r\n  'Harmonization',\r\n  HarmonizationSchema,\r\n);\r\n\r\nexport default Harmonization;\r\n"]}